<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·æ³¨å†Œ - Dify çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .register-container {
            width: 100%;
            max-width: 480px;
        }

        .register-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .logo-section {
            text-align: center;
            margin-bottom: 32px;
        }

        .logo {
            font-size: 36px;
            margin-bottom: 12px;
            color: #3b82f6;
        }

        .logo-section h1 {
            font-size: 24px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
        }

        .logo-section p {
            font-size: 14px;
            color: #6b7280;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 8px;
        }

        .form-label .required {
            color: #ef4444;
            margin-left: 4px;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-input.error {
            border-color: #ef4444;
        }

        .form-input.success {
            border-color: #10b981;
        }

        .password-strength {
            margin-top: 8px;
        }

        .strength-meter {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .strength-weak {
            background: #ef4444;
        }

        .strength-medium {
            background: #f59e0b;
        }

        .strength-strong {
            background: #10b981;
        }

        .strength-text {
            font-size: 12px;
            color: #6b7280;
        }

        .error-message {
            font-size: 12px;
            color: #ef4444;
            margin-top: 4px;
            display: none;
        }

        .success-message {
            font-size: 12px;
            color: #10b981;
            margin-top: 4px;
            display: none;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .terms-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            margin-bottom: 24px;
        }

        .terms-checkbox input[type="checkbox"] {
            margin-top: 4px;
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .terms-text {
            font-size: 13px;
            color: #6b7280;
            line-height: 1.5;
        }

        .terms-text a {
            color: #3b82f6;
            text-decoration: none;
        }

        .terms-text a:hover {
            text-decoration: underline;
        }

        .btn {
            width: 100%;
            padding: 14px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }

        .login-link {
            text-align: center;
            margin-top: 24px;
            font-size: 14px;
            color: #6b7280;
        }

        .login-link a {
            color: #3b82f6;
            text-decoration: none;
            font-weight: 500;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .tech-section {
            background: white;
            border-radius: 12px;
            padding: 32px;
            margin-top: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .tech-section h2 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
            color: #111827;
        }

        .tech-item {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid #f3f4f6;
        }

        .tech-item:last-child {
            border-bottom: none;
        }

        .tech-item h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #374151;
        }

        .tech-item p {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.6;
        }

        .tech-item ul {
            margin-left: 20px;
            margin-top: 8px;
        }

        .tech-item li {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 6px;
        }

        .code-block {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 16px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #374151;
            overflow-x: auto;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div class="register-container">
        <div class="register-card">
            <div class="logo-section">
                <div class="logo">ğŸš€</div>
                <h1>åˆ›å»ºæ–°è´¦å·</h1>
                <p>åŠ å…¥ Dify çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ</p>
            </div>

            <div class="alert alert-error" id="errorAlert" style="display: none;">
                æ³¨å†Œå¤±è´¥ï¼Œè¯·æ£€æŸ¥è¾“å…¥ä¿¡æ¯ã€‚
            </div>

            <div class="alert alert-success" id="successAlert" style="display: none;">
                æ³¨å†ŒæˆåŠŸï¼æ­£åœ¨è·³è½¬åˆ°éªŒè¯é¡µé¢...
            </div>

            <form id="registerForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="username">
                            ç”¨æˆ·å <span class="required">*</span>
                        </label>
                        <input type="text" id="username" class="form-input" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" required>
                        <div class="error-message" id="usernameError">ç”¨æˆ·åå¿…é¡»ä¸º3-20ä½å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿</div>
                        <div class="success-message" id="usernameSuccess">ç”¨æˆ·åå¯ç”¨</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="email">
                            é‚®ç®± <span class="required">*</span>
                        </label>
                        <input type="email" id="email" class="form-input" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" required>
                        <div class="error-message" id="emailError">è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€</div>
                        <div class="success-message" id="emailSuccess">é‚®ç®±æ ¼å¼æ­£ç¡®</div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="password">
                            å¯†ç  <span class="required">*</span>
                        </label>
                        <input type="password" id="password" class="form-input" placeholder="è¯·è¾“å…¥å¯†ç " required>
                        <div class="password-strength">
                            <div class="strength-text" id="strengthText">å¯†ç å¼ºåº¦ï¼šå¼±</div>
                            <div class="strength-meter">
                                <div class="strength-bar strength-weak" id="strengthBar"></div>
                            </div>
                        </div>
                        <div class="error-message" id="passwordError">å¯†ç å¿…é¡»åŒ…å«å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ï¼Œé•¿åº¦8-32ä½</div>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="confirmPassword">
                            ç¡®è®¤å¯†ç  <span class="required">*</span>
                        </label>
                        <input type="password" id="confirmPassword" class="form-input" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç " required>
                        <div class="error-message" id="confirmPasswordError">ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´</div>
                        <div class="success-message" id="confirmPasswordSuccess">å¯†ç ä¸€è‡´</div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="fullName">
                        å§“å
                    </label>
                    <input type="text" id="fullName" class="form-input" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“åï¼ˆå¯é€‰ï¼‰">
                </div>

                <div class="form-group">
                    <label class="form-label" for="company">
                        å…¬å¸/ç»„ç»‡
                    </label>
                    <input type="text" id="company" class="form-input" placeholder="è¯·è¾“å…¥å…¬å¸æˆ–ç»„ç»‡åç§°ï¼ˆå¯é€‰ï¼‰">
                </div>

                <div class="terms-checkbox">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms" class="terms-text">
                        æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="terms.html">æœåŠ¡æ¡æ¬¾</a> å’Œ <a href="privacy.html">éšç§æ”¿ç­–</a>
                    </label>
                </div>
                <div class="error-message" id="termsError">è¯·åŒæ„æœåŠ¡æ¡æ¬¾å’Œéšç§æ”¿ç­–</div>

                <button type="submit" class="btn btn-primary" id="registerBtn">
                    æ³¨å†Œè´¦å·
                </button>
            </form>

            <div class="login-link">
                å·²æœ‰è´¦å·ï¼Ÿ <a href="login.html">ç«‹å³ç™»å½•</a>
            </div>
        </div>

        <div class="tech-section">
            <h2>ğŸ“‹ åŠŸèƒ½è¯´æ˜ä¸æŠ€æœ¯å®ç°</h2>

            <div class="tech-item">
                <h3>1. ç”¨æˆ·æ³¨å†Œæµç¨‹</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>æ”¶é›†ç”¨æˆ·ä¿¡æ¯å¹¶åˆ›å»ºè´¦å·ï¼Œæ”¯æŒé‚®ç®±éªŒè¯ã€‚</p>
                <p><strong>å‰ç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>å®æ—¶è¡¨å•éªŒè¯ï¼šç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥ã€é‚®ç®±æ ¼å¼éªŒè¯ã€å¯†ç å¼ºåº¦è¯„ä¼°</li>
                    <li>å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨ï¼šå®æ—¶æ˜¾ç¤ºå¯†ç å¼ºåº¦ç­‰çº§</li>
                    <li>å¼‚æ­¥éªŒè¯ï¼šç”¨æˆ·å/é‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥ï¼ˆé˜²é‡å¤æ³¨å†Œï¼‰</li>
                    <li>é˜²é‡å¤æäº¤ï¼šæäº¤åç¦ç”¨æŒ‰é’®ï¼Œé˜²æ­¢å¤šæ¬¡æäº¤</li>
                    <li>è¿›åº¦æŒ‡ç¤ºï¼šæ˜¾ç¤ºæ³¨å†Œè¿‡ç¨‹çš„å„ä¸ªé˜¶æ®µ</li>
                </ul>
                <p><strong>åç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>POST /api/v1/auth/register - ç”¨æˆ·æ³¨å†Œæ¥å£</li>
                    <li>æ•°æ®éªŒè¯ï¼šå­—æ®µæ ¼å¼ã€å”¯ä¸€æ€§ã€ä¸šåŠ¡è§„åˆ™éªŒè¯</li>
                    <li>å¯†ç åŠ å¯†ï¼šä½¿ç”¨ bcrypt æˆ– Argon2 å“ˆå¸Œå¯†ç </li>
                    <li>é‚®ç®±éªŒè¯ï¼šå‘é€éªŒè¯é‚®ä»¶ï¼Œç”ŸæˆéªŒè¯ä»¤ç‰Œ</li>
                    <li>ç”¨æˆ·é»˜è®¤è®¾ç½®ï¼šåˆå§‹åŒ–ç”¨æˆ·é…ç½®ã€æƒé™ã€ç©ºé—´é…é¢</li>
                </ul>
                <div class="code-block">
// å‰ç«¯æ³¨å†Œè¯·æ±‚ç¤ºä¾‹
async function register(userData) {
    const response = await fetch('/api/v1/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(userData)
    });

    if (response.ok) {
        const data = await response.json();
        if (data.requires_verification) {
            // éœ€è¦é‚®ç®±éªŒè¯
            window.location.href = `/verify-email.html?email=${encodeURIComponent(userData.email)}`;
        } else {
            // ç›´æ¥ç™»å½•
            localStorage.setItem('access_token', data.access_token);
            window.location.href = 'index.html';
        }
    } else {
        const error = await response.json();
        showError(error.message);
    }
}

// ç”¨æˆ·åå”¯ä¸€æ€§æ£€æŸ¥
async function checkUsername(username) {
    const response = await fetch(`/api/v1/auth/check-username?username=${encodeURIComponent(username)}`);
    return await response.json();
}
                </div>
            </div>

            <div class="tech-item">
                <h3>2. å¯†ç å®‰å…¨ç­–ç•¥</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>ç¡®ä¿ç”¨æˆ·å¯†ç çš„å®‰å…¨æ€§ã€‚</p>
                <p><strong>å‰ç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>å¯†ç å¼ºåº¦è¯„ä¼°ï¼šåŸºäºé•¿åº¦ã€å­—ç¬¦ç±»å‹ã€å¤æ‚åº¦è®¡ç®—</li>
                    <li>å¯†ç å¯è§æ€§åˆ‡æ¢ï¼šæ˜¾ç¤º/éšè—å¯†ç åŠŸèƒ½</li>
                    <li>å¯†ç è§„åˆ™æç¤ºï¼šå®æ—¶æ˜¾ç¤ºå¯†ç è¦æ±‚</li>
                    <li>å¯†ç å†å²æ£€æŸ¥ï¼ˆå¯é€‰ï¼‰ï¼šé¿å…ä½¿ç”¨è¿‘æœŸç”¨è¿‡çš„å¯†ç </li>
                </ul>
                <p><strong>åç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>å¯†ç ç­–ç•¥é…ç½®ï¼šå¯é…ç½®çš„å¤æ‚åº¦è¦æ±‚</li>
                    <li>å¯†ç å“ˆå¸Œï¼šä½¿ç”¨å®‰å…¨çš„å“ˆå¸Œç®—æ³•å’Œç›å€¼</li>
                    <li>å¯†ç è¿‡æœŸç­–ç•¥ï¼šå®šæœŸè¦æ±‚æ›´æ¢å¯†ç </li>
                    <li>å¯†ç å†å²è®°å½•ï¼šå­˜å‚¨å†å²å¯†ç å“ˆå¸Œï¼Œé˜²æ­¢é‡ç”¨</li>
                </ul>
                <div class="code-block">
# å¯†ç å¼ºåº¦è¯„ä¼°ç®—æ³•
def evaluate_password_strength(password):
    score = 0

    # é•¿åº¦å¾—åˆ†
    if len(password) >= 8:
        score += 1
    if len(password) >= 12:
        score += 1

    # å­—ç¬¦ç±»å‹å¾—åˆ†
    if re.search(r'[a-z]', password):
        score += 1
    if re.search(r'[A-Z]', password):
        score += 1
    if re.search(r'\d', password):
        score += 1
    if re.search(r'[!@#$%^&*(),.?":{}|<>]', password):
        score += 1

    # åˆ¤æ–­å¼ºåº¦ç­‰çº§
    if score <= 2:
        return 'weak'
    elif score <= 4:
        return 'medium'
    else:
        return 'strong'

# åç«¯å¯†ç å“ˆå¸Œ
def hash_password(password):
    salt = bcrypt.gensalt(rounds=12)
    hashed = bcrypt.hashpw(password.encode('utf-8'), salt)
    return hashed.decode('utf-8')
                </div>
            </div>

            <div class="tech-item">
                <h3>3. é‚®ç®±éªŒè¯ç³»ç»Ÿ</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>éªŒè¯ç”¨æˆ·é‚®ç®±åœ°å€çš„çœŸå®æ€§ï¼Œé˜²æ­¢åƒåœ¾è´¦å·ã€‚</p>
                <p><strong>å‰ç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>éªŒè¯é‚®ä»¶å‘é€çŠ¶æ€æ˜¾ç¤º</li>
                    <li>éªŒè¯é¡µé¢ï¼šè¾“å…¥éªŒè¯ç æˆ–ç‚¹å‡»éªŒè¯é“¾æ¥</li>
                    <li>é‡æ–°å‘é€éªŒè¯é‚®ä»¶åŠŸèƒ½</li>
                    <li>éªŒè¯å€’è®¡æ—¶ï¼šé™åˆ¶é¢‘ç¹å‘é€éªŒè¯é‚®ä»¶</li>
                </ul>
                <p><strong>åç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>éªŒè¯ä»¤ç‰Œç”Ÿæˆï¼šJWT æˆ–éšæœºä»¤ç‰Œ</li>
                    <li>é‚®ä»¶å‘é€æœåŠ¡ï¼šä½¿ç”¨ SMTP æˆ–ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡</li>
                    <li>éªŒè¯çŠ¶æ€ç®¡ç†ï¼šè®°å½•éªŒè¯çŠ¶æ€å’Œæ—¶é—´</li>
                    <li>ä»¤ç‰Œè¿‡æœŸå¤„ç†ï¼šè®¾ç½®æœ‰æ•ˆæœŸé™</li>
                    <li>é˜²æ»¥ç”¨æœºåˆ¶ï¼šé™åˆ¶åŒä¸€é‚®ç®±çš„éªŒè¯è¯·æ±‚é¢‘ç‡</li>
                </ul>
                <div class="code-block">
# é‚®ç®±éªŒè¯ä»¤ç‰Œç”Ÿæˆ
def generate_verification_token(user_id, email):
    payload = {
        'user_id': user_id,
        'email': email,
        'exp': datetime.utcnow() + timedelta(hours=24)
    }
    token = jwt.encode(payload, SECRET_KEY, algorithm='HS256')
    return token

# å‘é€éªŒè¯é‚®ä»¶
def send_verification_email(user_email, token):
    verification_url = f'{BASE_URL}/verify-email?token={token}'

    html_content = f'''
    <h2>æ¬¢è¿æ³¨å†Œ Dify çŸ¥è¯†åº“ç®¡ç†ç³»ç»Ÿ</h2>
    <p>è¯·ç‚¹å‡»ä»¥ä¸‹é“¾æ¥éªŒè¯æ‚¨çš„é‚®ç®±åœ°å€ï¼š</p>
    <p><a href="{verification_url}">éªŒè¯é‚®ç®±</a></p>
    <p>å¦‚æœé“¾æ¥æ— æ•ˆï¼Œè¯·å¤åˆ¶ä»¥ä¸‹åœ°å€åˆ°æµè§ˆå™¨ï¼š</p>
    <p>{verification_url}</p>
    <p>è¯¥é“¾æ¥24å°æ—¶å†…æœ‰æ•ˆã€‚</p>
    '''

    send_email(
        to=user_email,
        subject='è¯·éªŒè¯æ‚¨çš„é‚®ç®±åœ°å€ - Dify',
        html=html_content
    )
                </div>
            </div>

            <div class="tech-item">
                <h3>4. ç”¨æˆ·èµ„æ–™åˆå§‹åŒ–</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>ä¸ºæ–°ç”¨æˆ·åˆ›å»ºé»˜è®¤é…ç½®å’Œèµ„æºã€‚</p>
                <p><strong>åç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>é»˜è®¤è§’è‰²åˆ†é…ï¼šæ ¹æ®æ³¨å†Œç±»å‹åˆ†é…æƒé™</li>
                    <li>èµ„æºé…é¢è®¾ç½®ï¼šçŸ¥è¯†åº“æ•°é‡ã€æ–‡æ¡£å¤§å°é™åˆ¶</li>
                    <li>ä¸ªäººç©ºé—´åˆ›å»ºï¼šç”¨æˆ·çš„é»˜è®¤å·¥ä½œç©ºé—´</li>
                    <li>æ¬¢è¿å†…å®¹ï¼šåˆ›å»ºç¤ºä¾‹çŸ¥è¯†åº“å’Œæ–‡æ¡£</li>
                    <li>ä½¿ç”¨å¼•å¯¼ï¼šè®°å½•æ–°ç”¨æˆ·å¼•å¯¼çŠ¶æ€</li>
                </ul>
                <div class="code-block">
# ç”¨æˆ·åˆå§‹åŒ–æµç¨‹
def initialize_user(user_id):
    # 1. åˆ›å»ºé»˜è®¤è§’è‰²
    assign_default_role(user_id)

    # 2. è®¾ç½®èµ„æºé…é¢
    set_resource_quota(user_id, {
        'max_knowledge_bases': 10,
        'max_document_size': 100 * 1024 * 1024,  # 100MB
        'max_documents': 1000
    })

    # 3. åˆ›å»ºä¸ªäººç©ºé—´
    personal_space = create_personal_space(user_id)

    # 4. åˆ›å»ºç¤ºä¾‹çŸ¥è¯†åº“ï¼ˆå¯é€‰ï¼‰
    if user_is_newbie(user_id):
        create_example_knowledge_base(user_id, personal_space.id)

    # 5. å‘é€æ¬¢è¿é‚®ä»¶
    send_welcome_email(user_id)

    return personal_space
                </div>
            </div>

            <div class="tech-item">
                <h3>5. é˜²æ»¥ç”¨å’Œå®‰å…¨æœºåˆ¶</h3>
                <p><strong>åŠŸèƒ½æè¿°ï¼š</strong>é˜²æ­¢æ¶æ„æ³¨å†Œå’Œæ»¥ç”¨ã€‚</p>
                <p><strong>å‰ç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>äººæœºéªŒè¯ï¼šé›†æˆ reCAPTCHA æˆ– hCaptcha</li>
                    <li>æ³¨å†Œé¢‘ç‡é™åˆ¶ï¼šåŒä¸€IPçš„æ³¨å†Œæ¬¡æ•°é™åˆ¶</li>
                    <li>å¯ç–‘è¡Œä¸ºæ£€æµ‹ï¼šå¼‚å¸¸æ³¨å†Œæ¨¡å¼è¯†åˆ«</li>
                </ul>
                <p><strong>åç«¯å®ç°ï¼š</strong></p>
                <ul>
                    <li>IPé™åˆ¶ï¼šåŸºäºIPåœ°å€çš„æ³¨å†Œé¢‘ç‡æ§åˆ¶</li>
                    <li>é‚®ç®±åŸŸåè¿‡æ»¤ï¼šç¦æ­¢ä¸´æ—¶é‚®ç®±æˆ–åƒåœ¾é‚®ç®±åŸŸå</li>
                    <li>è¡Œä¸ºåˆ†æï¼šæ£€æµ‹æ‰¹é‡æ³¨å†Œè¡Œä¸º</li>
                    <li>å®¡æ ¸æœºåˆ¶ï¼šé«˜é£é™©æ³¨å†Œéœ€è¦äººå·¥å®¡æ ¸</li>
                </ul>
                <div class="code-block">
# æ³¨å†Œé˜²æ»¥ç”¨æ£€æŸ¥
def check_registration_abuse(ip_address, email):
    # æ£€æŸ¥IPæ³¨å†Œé¢‘ç‡
    recent_registrations = get_recent_registrations_by_ip(ip_address, hours=24)
    if len(recent_registrations) >= 10:
        raise AbuseError('æ³¨å†Œè¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•')

    # æ£€æŸ¥é‚®ç®±åŸŸå
    email_domain = email.split('@')[-1]
    if email_domain in BLACKLISTED_DOMAINS:
        raise AbuseError('è¯¥é‚®ç®±åŸŸåä¸è¢«å…è®¸')

    # éªŒè¯reCAPTCHA
    recaptcha_response = request.json.get('recaptcha_token')
    if not verify_recaptcha(recaptcha_response):
        raise AbuseError('äººæœºéªŒè¯å¤±è´¥')

    return True
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOM å…ƒç´ 
        const registerForm = document.getElementById('registerForm');
        const usernameInput = document.getElementById('username');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const agreeTermsCheckbox = document.getElementById('agreeTerms');
        const registerBtn = document.getElementById('registerBtn');

        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');

        // å®æ—¶éªŒè¯
        usernameInput.addEventListener('input', debounce(validateUsername, 500));
        emailInput.addEventListener('input', debounce(validateEmail, 500));
        passwordInput.addEventListener('input', validatePassword);
        confirmPasswordInput.addEventListener('input', validateConfirmPassword);

        // è¡¨å•æäº¤å¤„ç†
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();

            // éªŒè¯æ‰€æœ‰å­—æ®µ
            const isUsernameValid = validateUsername();
            const isEmailValid = validateEmail();
            const isPasswordValid = validatePassword();
            const isConfirmPasswordValid = validateConfirmPassword();
            const isTermsAgreed = validateTerms();

            if (isUsernameValid && isEmailValid && isPasswordValid &&
                isConfirmPasswordValid && isTermsAgreed) {

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                registerBtn.disabled = true;
                registerBtn.innerHTML = 'æ³¨å†Œä¸­...';

                // æ¨¡æ‹Ÿæ³¨å†Œè¯·æ±‚ï¼ˆå®é™…åº”è°ƒç”¨APIï¼‰
                setTimeout(() => {
                    // æ¨¡æ‹Ÿæ³¨å†ŒæˆåŠŸ
                    document.getElementById('successAlert').style.display = 'block';
                    document.getElementById('errorAlert').style.display = 'none';

                    // æ¨¡æ‹Ÿè·³è½¬
                    setTimeout(() => {
                        window.location.href = 'login.html?registered=true';
                    }, 2000);
                }, 2000);
            } else {
                document.getElementById('errorAlert').style.display = 'block';
                document.getElementById('errorAlert').textContent = 'è¯·æ£€æŸ¥è¡¨å•ä¸­çš„é”™è¯¯ä¿¡æ¯';
            }
        });

        // éªŒè¯ç”¨æˆ·å
        function validateUsername() {
            const username = usernameInput.value.trim();
            const errorElement = document.getElementById('usernameError');
            const successElement = document.getElementById('usernameSuccess');

            // é‡ç½®çŠ¶æ€
            resetValidation(usernameInput, errorElement, successElement);

            if (!username) {
                showError(usernameInput, errorElement, 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
                return false;
            }

            // ç”¨æˆ·åè§„åˆ™ï¼š3-20ä½å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
            const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
            if (!usernameRegex.test(username)) {
                showError(usernameInput, errorElement, 'ç”¨æˆ·åå¿…é¡»ä¸º3-20ä½å­—æ¯ã€æ•°å­—æˆ–ä¸‹åˆ’çº¿');
                return false;
            }

            // æ¨¡æ‹Ÿå¼‚æ­¥æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦å¯ç”¨
            // å®é™…é¡¹ç›®ä¸­è¿™é‡Œåº”è¯¥è°ƒç”¨APIæ£€æŸ¥ç”¨æˆ·åå”¯ä¸€æ€§
            if (username.length >= 3) {
                showSuccess(usernameInput, successElement, 'ç”¨æˆ·åå¯ç”¨');
                return true;
            }

            return false;
        }

        // éªŒè¯é‚®ç®±
        function validateEmail() {
            const email = emailInput.value.trim();
            const errorElement = document.getElementById('emailError');
            const successElement = document.getElementById('emailSuccess');

            resetValidation(emailInput, errorElement, successElement);

            if (!email) {
                showError(emailInput, errorElement, 'é‚®ç®±ä¸èƒ½ä¸ºç©º');
                return false;
            }

            // é‚®ç®±æ ¼å¼éªŒè¯
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showError(emailInput, errorElement, 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€');
                return false;
            }

            // æ¨¡æ‹Ÿé‚®ç®±å”¯ä¸€æ€§æ£€æŸ¥
            if (email.includes('@')) {
                showSuccess(emailInput, successElement, 'é‚®ç®±æ ¼å¼æ­£ç¡®');
                return true;
            }

            return false;
        }

        // éªŒè¯å¯†ç å¼ºåº¦
        function validatePassword() {
            const password = passwordInput.value;
            const errorElement = document.getElementById('passwordError');

            resetValidation(passwordInput, errorElement);

            if (!password) {
                showError(passwordInput, errorElement, 'å¯†ç ä¸èƒ½ä¸ºç©º');
                updatePasswordStrength(0);
                return false;
            }

            // å¯†ç è§„åˆ™ï¼šè‡³å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—
            if (password.length < 8) {
                showError(passwordInput, errorElement, 'å¯†ç é•¿åº¦è‡³å°‘8ä½');
                updatePasswordStrength(1);
                return false;
            }

            // å¯†ç å¼ºåº¦è¯„ä¼°
            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength++;

            updatePasswordStrength(strength);

            if (strength < 3) {
                showError(passwordInput, errorElement, 'å¯†ç å¼ºåº¦è¾ƒå¼±ï¼Œå»ºè®®åŒ…å«å¤§å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦');
                return false;
            }

            // æ¸…é™¤é”™è¯¯ï¼ŒéªŒè¯é€šè¿‡
            passwordInput.classList.remove('error');
            errorElement.style.display = 'none';
            return true;
        }

        // æ›´æ–°å¯†ç å¼ºåº¦æŒ‡ç¤ºå™¨
        function updatePasswordStrength(strength) {
            let width = 0;
            let text = 'å¯†ç å¼ºåº¦ï¼š';
            let colorClass = 'strength-weak';

            if (strength <= 1) {
                width = 33;
                text += 'å¼±';
                colorClass = 'strength-weak';
            } else if (strength <= 3) {
                width = 66;
                text += 'ä¸­';
                colorClass = 'strength-medium';
            } else {
                width = 100;
                text += 'å¼º';
                colorClass = 'strength-strong';
            }

            strengthBar.style.width = `${width}%`;
            strengthBar.className = `strength-bar ${colorClass}`;
            strengthText.textContent = text;
        }

        // éªŒè¯ç¡®è®¤å¯†ç 
        function validateConfirmPassword() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const errorElement = document.getElementById('confirmPasswordError');
            const successElement = document.getElementById('confirmPasswordSuccess');

            resetValidation(confirmPasswordInput, errorElement, successElement);

            if (!confirmPassword) {
                showError(confirmPasswordInput, errorElement, 'è¯·å†æ¬¡è¾“å…¥å¯†ç ');
                return false;
            }

            if (password !== confirmPassword) {
                showError(confirmPasswordInput, errorElement, 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´');
                return false;
            }

            showSuccess(confirmPasswordInput, successElement, 'å¯†ç ä¸€è‡´');
            return true;
        }

        // éªŒè¯æœåŠ¡æ¡æ¬¾
        function validateTerms() {
            const errorElement = document.getElementById('termsError');

            if (!agreeTermsCheckbox.checked) {
                errorElement.style.display = 'block';
                return false;
            }

            errorElement.style.display = 'none';
            return true;
        }

        // æ˜¾ç¤ºé”™è¯¯
        function showError(inputElement, errorElement, message) {
            inputElement.classList.add('error');
            inputElement.classList.remove('success');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        // æ˜¾ç¤ºæˆåŠŸ
        function showSuccess(inputElement, successElement, message) {
            inputElement.classList.remove('error');
            inputElement.classList.add('success');
            successElement.textContent = message;
            successElement.style.display = 'block';
        }

        // é‡ç½®éªŒè¯çŠ¶æ€
        function resetValidation(inputElement, errorElement, successElement = null) {
            inputElement.classList.remove('error', 'success');
            if (errorElement) errorElement.style.display = 'none';
            if (successElement) successElement.style.display = 'none';
        }

        // é˜²æŠ–å‡½æ•°
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', function() {
            // å¦‚æœæœ‰æ³¨å†ŒæˆåŠŸçš„å‚æ•°ï¼Œæ˜¾ç¤ºæˆåŠŸæç¤º
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('registered') === 'true') {
                document.getElementById('successAlert').style.display = 'block';
                document.getElementById('successAlert').textContent = 'æ³¨å†ŒæˆåŠŸï¼è¯·ç™»å½•æ‚¨çš„è´¦å·ã€‚';
            }
        });
    </script>
</body>
</html>